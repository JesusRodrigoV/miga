<div class="planes-container">
  <div class="header-section">
    <h2>Mis Planes de Negocio</h2>

    <mg-button
      label="+ Nuevo Plan"
      (onClick)="crearNuevoPlan()"
      [loading]="planesStore.isLoading()"
      [fluid]="false"
      severity="primary"
    />
  </div>

  <ul class="plan-list">
    @for (plan of planesStore.planes(); track plan.id) {
    <li class="plan-card">
      <div class="plan-info">
        <span
          class="status-badge"
          [class.borrador]="plan.estado === 'borrador'"
          [class.finalizado]="plan.estado === 'final'"
        >
          {{ plan.estado | uppercase }}
        </span>
        <span class="date-info">
          <i class="pi pi-calendar" style="margin-right: 5px"></i>
          Creado el {{ plan.created_at | date: 'dd MMM, yyyy' }}
        </span>
      </div>

      <div class="plan-actions" style="display: flex; gap: 0.5rem">
        <mg-button
          [severity]="plan.estado === 'final' ? 'info' : 'secondary'"
          (onClick)="abrir(plan.id)"
          [fluid]="false"
          [size]="size"
        >
          {{ plan.estado == 'final' ? 'Editar' : 'Continuar' }}
        </mg-button>

        <mg-button
          severity="warn"
          [fluid]="false"
          [size]="size"
          (onClick)="generarPDF(plan.id)"
          [loading]="pdfStore.isLoading() && pdfStore.currentPlanId() === plan.id"
          [disabled]="plan.estado !== 'final' || pdfStore.isLoading()"
        >
          PDF
        </mg-button>

        <mg-button
          severity="danger"
          (onClick)="eliminar(plan.id)"
          [fluid]="false"
          [size]="size"
        >
          <ion-icon name="trash-outline"></ion-icon>
        </mg-button>
      </div>
    </li>
    } @empty {
    <li class="empty-state">
      <i
        class="pi pi-folder-open"
        style="font-size: 2rem; margin-bottom: 1rem"
      ></i>
      <p>Aún no tienes ningún plan.</p>
    </li>
    }
  </ul>
</div>
